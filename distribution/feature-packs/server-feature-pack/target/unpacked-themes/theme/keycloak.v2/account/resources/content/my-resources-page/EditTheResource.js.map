{"version":3,"sources":["../../../src/app/content/my-resources-page/EditTheResource.tsx"],"names":["React","Button","Modal","Form","FormGroup","TextInput","InputGroup","OkIcon","Scope","Msg","AccountServiceContext","ContentAlert","PermissionSelect","EditTheResource","Component","constructor","props","context","state","isOpen","setState","onClose","clearState","row","changed","savePermission","permission","doPut","resource","_id","success","localize","render","children","handleToggleDialog","name","permissions","map","p","username","scopes","s","length","selection","updateChanged"],"mappings":"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","sourcesContent":["/*\r\n * Copyright 2019 Red Hat, Inc. and/or its affiliates.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport * as React from 'react';\r\n\r\nimport {\r\n    Button,\r\n    Modal,\r\n    Form,\r\n    FormGroup,\r\n    TextInput,\r\n    InputGroup\r\n} from '@patternfly/react-core';\r\nimport { OkIcon } from '@patternfly/react-icons';\r\n\r\nimport { Resource, Permission, Scope } from './resource-model';\r\nimport { Msg } from '../../widgets/Msg';\r\nimport { AccountServiceContext } from '../../account-service/AccountServiceContext';\r\nimport { ContentAlert } from '../ContentAlert';\r\nimport { PermissionSelect } from './PermissionSelect';\r\n\r\ninterface EditTheResourceProps {\r\n    resource: Resource;\r\n    permissions: Permission[];\r\n    onClose: () => void;\r\n    children: (toggle: () => void) => void;\r\n}\r\n\r\ninterface EditTheResourceState {\r\n    changed: boolean[];\r\n    isOpen: boolean;\r\n}\r\n\r\nexport class EditTheResource extends React.Component<EditTheResourceProps, EditTheResourceState> {\r\n    protected static defaultProps = { permissions: [] };\r\n    static contextType = AccountServiceContext;\r\n    context: React.ContextType<typeof AccountServiceContext>;\r\n\r\n    public constructor(props: EditTheResourceProps, context: React.ContextType<typeof AccountServiceContext>) {\r\n        super(props);\r\n        this.context = context;\r\n\r\n        this.state = {\r\n            changed: [],\r\n            isOpen: false,\r\n        };\r\n    }\r\n\r\n    private clearState(): void {\r\n        this.setState({});\r\n    }\r\n\r\n    private handleToggleDialog = () => {\r\n        if (this.state.isOpen) {\r\n            this.setState({ isOpen: false });\r\n            this.props.onClose();\r\n        } else {\r\n            this.clearState();\r\n            this.setState({ isOpen: true });\r\n        }\r\n    };\r\n\r\n    private updateChanged = (row: number) => {\r\n        const changed = this.state.changed;\r\n        changed[row] = !changed[row];\r\n        this.setState({ changed });\r\n    }\r\n\r\n    async savePermission(permission: Permission): Promise<void> {\r\n        await this.context!.doPut(`/resources/${this.props.resource._id}/permissions`, [permission]);\r\n        ContentAlert.success(Msg.localize('updateSuccess'));\r\n    }\r\n\r\n    public render(): React.ReactNode {\r\n        return (\r\n            <React.Fragment>\r\n                {this.props.children(this.handleToggleDialog)}\r\n\r\n                <Modal\r\n                    title={'Edit the resource - ' + this.props.resource.name}\r\n                    isLarge\r\n                    isOpen={this.state.isOpen}\r\n                    onClose={this.handleToggleDialog}\r\n                    actions={[\r\n                        <Button key=\"done\" variant=\"link\" id=\"done\" onClick={this.handleToggleDialog}>\r\n                            <Msg msgKey='done' />\r\n                        </Button>,\r\n                    ]}\r\n                >\r\n                    <Form isHorizontal>\r\n                        {this.props.permissions.map((p, row) => (\r\n                            <React.Fragment>\r\n                                <FormGroup\r\n                                    fieldId={`username-${row}`}\r\n                                    label={Msg.localize('User')}\r\n                                >\r\n                                    <TextInput id={`username-${row}`} type=\"text\" value={p.username} isDisabled />\r\n\r\n                                </FormGroup>\r\n                                <FormGroup\r\n                                    fieldId={`permissions-${row}`}\r\n                                    label={Msg.localize('permissions')}\r\n                                    isRequired\r\n                                >\r\n                                    <InputGroup>\r\n                                        <PermissionSelect\r\n                                            scopes={this.props.resource.scopes}\r\n                                            selected={(p.scopes as string[]).map(s => new Scope(s))}\r\n                                            direction={row === this.props.permissions.length - 1 ? \"up\" : \"down\"}\r\n                                            onSelect={selection => {\r\n                                                p.scopes = selection.map(s => s.name);\r\n                                                this.updateChanged(row);\r\n                                            }}\r\n                                        />\r\n                                        <Button\r\n                                            id={`save-${row}`}\r\n                                            isDisabled={!this.state.changed[row]}\r\n                                            onClick={() => this.savePermission(p)}\r\n                                        >\r\n                                            <OkIcon />\r\n                                        </Button>\r\n                                    </InputGroup>\r\n                                </FormGroup>\r\n                                <hr />\r\n                            </React.Fragment>\r\n                        ))}\r\n                    </Form>\r\n                </Modal>\r\n            </React.Fragment>\r\n        );\r\n    }\r\n}"],"file":"EditTheResource.js"}