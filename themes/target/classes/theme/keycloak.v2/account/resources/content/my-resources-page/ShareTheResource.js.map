{"version":3,"sources":["../../../src/app/content/my-resources-page/ShareTheResource.tsx"],"names":["React","Button","Chip","ChipGroup","ChipGroupToolbarItem","Form","FormGroup","Gallery","GalleryItem","Modal","Stack","StackItem","TextInput","AccountServiceContext","Msg","ContentAlert","PermissionSelect","ShareTheResource","Component","constructor","props","context","rscId","resource","_id","newPermissions","permission","state","permissionsSelected","push","name","permissions","username","usernames","scopes","handleToggleDialog","doPut","then","success","onClose","isOpen","setState","clearState","usernameInput","includes","response","doGet","params","value","data","info","event","key","preventDefault","handleAddUsername","newUsernames","filter","user","permissionsUnSelected","isAddDisabled","isAlreadyShared","isFormInvalid","length","render","children","handleAddPermission","localize","handleUsernameChange","handleEnterKeyInAddField","map","currentChip","handleDeleteUsername","selection","sharedWithUsersMsg"],"mappings":"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","sourcesContent":["/*\r\n * Copyright 2019 Red Hat, Inc. and/or its affiliates.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\nimport * as React from 'react';\r\n\r\nimport {\r\n    Button,\r\n    Chip,\r\n    ChipGroup,\r\n    ChipGroupToolbarItem,\r\n    Form,\r\n    FormGroup,\r\n    Gallery,\r\n    GalleryItem,\r\n    Modal,\r\n    Stack,\r\n    StackItem,\r\n    TextInput\r\n} from '@patternfly/react-core';\r\n\r\nimport { AccountServiceContext } from '../../account-service/AccountServiceContext';\r\nimport { Resource, Permission, Scope } from './resource-model';\r\nimport { Msg } from '../../widgets/Msg';\r\nimport {ContentAlert} from '../ContentAlert';\r\nimport { PermissionSelect } from './PermissionSelect';\r\n\r\ninterface ShareTheResourceProps {\r\n    resource: Resource;\r\n    permissions: Permission[];\r\n    sharedWithUsersMsg: React.ReactNode;\r\n    onClose: () => void;\r\n    children: (toggle: () => void) => void;\r\n}\r\n\r\ninterface ShareTheResourceState {\r\n    isOpen: boolean;\r\n    permissionsSelected: Scope[];\r\n    permissionsUnSelected: Scope[];\r\n    usernames: string[];\r\n    usernameInput: string;\r\n}\r\n\r\n/**\r\n * @author Stan Silvert ssilvert@redhat.com (C) 2019 Red Hat Inc.\r\n */\r\nexport class ShareTheResource extends React.Component<ShareTheResourceProps, ShareTheResourceState> {\r\n    protected static defaultProps = {permissions: []};\r\n    static contextType = AccountServiceContext;\r\n    context: React.ContextType<typeof AccountServiceContext>;\r\n\r\n    public constructor(props: ShareTheResourceProps, context: React.ContextType<typeof AccountServiceContext>) {\r\n        super(props);\r\n        this.context = context;\r\n    \r\n        this.state = {\r\n            isOpen: false,\r\n            permissionsSelected: [],\r\n            permissionsUnSelected: this.props.resource.scopes,\r\n            usernames: [],\r\n            usernameInput: ''\r\n        };\r\n    }\r\n\r\n    private clearState(): void {\r\n        this.setState({\r\n            permissionsSelected: [],\r\n            permissionsUnSelected: this.props.resource.scopes,\r\n            usernames: [],\r\n            usernameInput: ''\r\n        });\r\n    }\r\n\r\n    private handleAddPermission = () => {\r\n        const rscId: string = this.props.resource._id;\r\n        const newPermissions: string[] = [];\r\n\r\n        for (const permission of this.state.permissionsSelected) {\r\n            newPermissions.push(permission.name);\r\n        }\r\n\r\n        const permissions = [];\r\n\r\n        for (const username of this.state.usernames) {\r\n            permissions.push({username: username, scopes: newPermissions});\r\n        }\r\n\r\n        this.handleToggleDialog();\r\n\r\n        this.context!.doPut(`/resources/${rscId}/permissions`, permissions)\r\n            .then(() => {\r\n                ContentAlert.success('shareSuccess');\r\n                this.props.onClose();\r\n            })\r\n    };\r\n\r\n    private handleToggleDialog = () => {\r\n       if (this.state.isOpen) {\r\n           this.setState({isOpen: false});\r\n           this.props.onClose();\r\n       } else {\r\n           this.clearState();\r\n           this.setState({isOpen: true});\r\n       }\r\n    };\r\n\r\n    private handleUsernameChange = (username: string) => {\r\n        this.setState({usernameInput: username});\r\n    }\r\n\r\n    private handleAddUsername = async () => {\r\n        if ((this.state.usernameInput !== '') && (!this.state.usernames.includes(this.state.usernameInput))) {\r\n            const response = await this.context!.doGet<{username: string}>(`/resources/${this.props.resource._id}/user`, { params: { value: this.state.usernameInput } });\r\n            if (response.data && response.data.username) {\r\n                this.setState({ usernameInput: '', usernames: [...this.state.usernames, this.state.usernameInput] });\r\n            } else {\r\n                ContentAlert.info('userNotFound', [this.state.usernameInput]);\r\n            }\r\n        }\r\n    }\r\n\r\n    private handleEnterKeyInAddField = (event: React.KeyboardEvent) => {\r\n        if (event.key === \"Enter\") {\r\n            event.preventDefault();\r\n            this.handleAddUsername();\r\n        }\r\n    }\r\n\r\n    private handleDeleteUsername = (username: string) => {\r\n        const newUsernames: string[] = this.state.usernames.filter(user => user !== username);\r\n        this.setState({usernames: newUsernames});\r\n    }\r\n\r\n    private isAddDisabled(): boolean {\r\n        return this.state.usernameInput === '' || this.isAlreadyShared();\r\n    }\r\n\r\n    private isAlreadyShared(): boolean {\r\n        for (let permission of this.props.permissions) {\r\n            if (permission.username === this.state.usernameInput) return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    private isFormInvalid(): boolean {\r\n        return (this.state.usernames.length === 0) || (this.state.permissionsSelected.length === 0);\r\n    }\r\n\r\n    public render(): React.ReactNode {\r\n        return (\r\n            <React.Fragment>\r\n                {this.props.children(this.handleToggleDialog)}\r\n\r\n                <Modal\r\n                title={'Share the resource - ' + this.props.resource.name}\r\n                isLarge={true}\r\n                isOpen={this.state.isOpen}\r\n                onClose={this.handleToggleDialog}\r\n                actions={[\r\n                    <Button key=\"cancel\" variant=\"link\" onClick={this.handleToggleDialog}>\r\n                        <Msg msgKey='cancel'/>\r\n                    </Button>,\r\n                    <Button key=\"confirm\" variant=\"primary\" id=\"done\" onClick={this.handleAddPermission} isDisabled={this.isFormInvalid()}>\r\n                        <Msg msgKey='done'/>\r\n                    </Button>\r\n                ]}\r\n                >\r\n                    <Stack gutter='md'>\r\n                        <StackItem isFilled>\r\n                        <Form>\r\n                            <FormGroup\r\n                                label=\"Add users to share your resource with\"\r\n                                type=\"string\"\r\n                                helperTextInvalid={Msg.localize('resourceAlreadyShared')}\r\n                                fieldId=\"username\"\r\n                                isRequired\r\n                                isValid={!this.isAlreadyShared()}\r\n                                >\r\n                                    <Gallery gutter='sm'>\r\n                                        <GalleryItem>\r\n                                            <TextInput\r\n                                                value={this.state.usernameInput}\r\n                                                isValid={!this.isAlreadyShared()}\r\n                                                id=\"username\"\r\n                                                aria-describedby=\"username-helper\"\r\n                                                placeholder=\"Username or email\"\r\n                                                onChange={this.handleUsernameChange}\r\n                                                onKeyPress={this.handleEnterKeyInAddField}\r\n                                            />\r\n                                        </GalleryItem>\r\n                                        <GalleryItem>\r\n                                            <Button key=\"add-user\" variant=\"primary\" id=\"add\" onClick={this.handleAddUsername} isDisabled={this.isAddDisabled()}>\r\n                                                <Msg msgKey=\"add\"/>\r\n                                            </Button>\r\n                                        </GalleryItem>\r\n\r\n                                </Gallery>\r\n                                <ChipGroup withToolbar>\r\n                                    <ChipGroupToolbarItem key='users-selected' categoryName='Share with '>\r\n                                    {this.state.usernames.map((currentChip: string) => (\r\n                                        <Chip key={currentChip} onClick={() => this.handleDeleteUsername(currentChip)}>\r\n                                            {currentChip}\r\n                                        </Chip>\r\n                                    ))}\r\n                                    </ChipGroupToolbarItem>\r\n                                </ChipGroup>\r\n                            </FormGroup>\r\n                            <FormGroup\r\n                                label=\"\"\r\n                                fieldId=\"permissions-selected\"\r\n                            >\r\n                                <PermissionSelect\r\n                                    scopes={this.state.permissionsUnSelected}\r\n                                    onSelect={selection => this.setState({ permissionsSelected: selection })}\r\n                                    direction=\"up\"\r\n                                />\r\n                            </FormGroup>\r\n                        </Form>\r\n                    </StackItem>\r\n                    <StackItem isFilled><br/></StackItem>\r\n                    <StackItem isFilled>\r\n                        {this.props.sharedWithUsersMsg}\r\n                    </StackItem>\r\n\r\n                    </Stack>\r\n                </Modal>\r\n            </React.Fragment>\r\n        );\r\n    }\r\n}"],"file":"ShareTheResource.js"}